# ðŸ—ï¸ Arquitectura de la SoluciÃ³n

Documento que describe la arquitectura tÃ©cnica del sistema de ML para predicciÃ³n de reintentos de pagos.

---

## ðŸ“‹ VisiÃ³n General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SISTEMA DE PREDICCIÃ“N DE REINTENTOS             â”‚
â”‚                        ML for Payment Retry Success                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              AWS Cloud
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚                         â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ S3     â”‚             â”‚    Lambda      â”‚        â”‚  Step       â”‚
    â”‚Bucket  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Inference     â”‚        â”‚  Functions  â”‚
    â”‚        â”‚             â”‚    Engine      â”‚        â”‚  Machine    â”‚
    â”‚models/ â”‚             â”‚                â”‚        â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                        â”‚
        â”‚                        â”‚
        â”‚                  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚                  â”‚ CloudWatch â”‚
        â”‚                  â”‚   Logs     â”‚
        â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    Almacena                  Predice
  mejor_modelo.pkl           probabilidad
                             + decisiÃ³n
```

---

## ðŸ”„ Flujo de Datos - OpciÃ³n 1: InvocaciÃ³n Directa de Lambda

```
Usuario/Sistema Externo
         â”‚
         â”‚ POST /invoke
         â”‚ JSON: { monto, delta_horas, ... }
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         AWS Lambda (Docker)              â”‚
    â”‚     lambda_predict_reintento.py          â”‚
    â”‚                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ 1. Carga modelo de S3 (global)   â”‚   â”‚
    â”‚  â”‚    mejor_modelo.pkl              â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                    â–¼                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ 2. Valida entrada               â”‚   â”‚
    â”‚  â”‚    - Campos requeridos          â”‚   â”‚
    â”‚  â”‚    - Tipos correctos            â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                    â–¼                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ 3. Preprocesa features          â”‚   â”‚
    â”‚  â”‚    - StandardScaler (num)       â”‚   â”‚
    â”‚  â”‚    - OneHotEncoder (cat)        â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                    â–¼                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ 4. Realiza predicciÃ³n           â”‚   â”‚
    â”‚  â”‚    predict_proba() â†’ [0.78]     â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                    â–¼                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ 5. Aplica threshold             â”‚   â”‚
    â”‚  â”‚    0.78 >= 0.3 â†’ True           â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                    â–¼                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ 6. Retorna respuesta             â”‚   â”‚
    â”‚  â”‚    { prob: 0.78, reintentar: T }â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ { statusCode: 200, body: {...} }
         â”‚
         â–¼
    Usuario/Sistema Externo
```

---

## ðŸ”„ Flujo de Datos - OpciÃ³n 2: Batch via Step Functions

```
Sistema de Reintentos (Backend)
         â”‚
         â”‚ start-execution()
         â”‚ { retries: [...] }
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         AWS Step Functions                    â”‚
    â”‚       State Machine (OrquestaciÃ³n)           â”‚
    â”‚                                              â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Pass State: Preparar Input             â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                    â–¼                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Map State: Iterar sobre retries        â”‚  â”‚
    â”‚  â”‚ (MaxConcurrency: 5)                    â”‚  â”‚
    â”‚  â”‚                                        â”‚  â”‚
    â”‚  â”‚   Para cada reintento:                 â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
    â”‚  â”‚   â”‚ Task: Invoke Lambda              â”‚ â”‚  â”‚
    â”‚  â”‚   â”‚ Espera resultado                 â”‚ â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
    â”‚  â”‚               â–¼                       â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
    â”‚  â”‚   â”‚ Choice: DecisiÃ³n                 â”‚ â”‚  â”‚
    â”‚  â”‚   â”‚ IF reintentar == true            â”‚ â”‚  â”‚
    â”‚  â”‚   â”‚   â†’ Estado "Aprobado"            â”‚ â”‚  â”‚
    â”‚  â”‚   â”‚ ELSE                             â”‚ â”‚  â”‚
    â”‚  â”‚   â”‚   â†’ Estado "Rechazado"           â”‚ â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
    â”‚  â”‚               â–¼                       â”‚  â”‚
    â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
    â”‚  â”‚   â”‚ Pass: Finalizar resultado        â”‚ â”‚  â”‚
    â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                    â–¼                         â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ Pass State: Generar Output             â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ { results: [...] }
         â”‚
         â–¼
    Sistema de Reintentos
```

---

## ðŸŒ Arquitectura de AWS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            AWS ACCOUNT                                   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      VPC (Opcional)                                 â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚                    COMPUTE LAYER                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  AWS Lambda (DockerImageFunction)                    â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Name: InferenceLambda                            â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Runtime: Python 3.11 (Custom Docker Image)       â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Timeout: 60 seg | Memory: 512 MB                 â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Env Vars:                                        â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ MODEL_BUCKET: ml-retries-model-*             â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ MODEL_KEY: models/mejor_modelo.pkl          â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ THRESHOLD: 0.3                               â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€ LOG_LEVEL: INFO                              â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ IAM Role: LambdaExecutionRole                    â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     Permisos:                                        â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â””â”€ s3:GetObject en MODEL_BUCKET                 â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  AWS Step Functions (State Machine)                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Name: RetriesStateMachine                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Type: Standard                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ States:                                                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ PrepareInput (Pass)                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ ProcessRetriesMap (Map)                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ InvokeInferenceLambda (Task)                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ DecidirReintento (Choice)                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ ReintentoAprobado (Pass)                             â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ ReintentoRechazado (Pass)                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ IAM Role: StepFunctionsRole                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     Permisos:                                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚     â””â”€ lambda:InvokeFunction on InferenceLambda            â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                                                           â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                      STORAGE LAYER                                 â”‚ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Amazon S3 (Bucket)                                      â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Name: ml-retries-model-{ACCOUNT}-{REGION}           â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Versioning: Enabled                                  â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Encryption: SSE-S3                                   â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Public Access: Blocked                               â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Contents:                                            â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ models/mejor_modelo.pkl                          â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Lifecycle: Retain on delete                          â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                                                           â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                    MONITORING LAYER                                â”‚ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  CloudWatch Logs                                         â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Log Group: /aws/lambda/ml-retries-inference          â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Retention: 30 days                                   â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Logs from: Lambda execution                          â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  CloudWatch Metrics                                      â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Lambda Invocations                                   â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Lambda Duration                                      â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ Lambda Errors                                        â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ Step Functions Executions                            â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                                                           â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“¦ Componentes de Software

### Lambda Container (Docker)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   public.ecr.aws/lambda/python:3.11      â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Python Runtime 3.11               â”‚   â”‚
â”‚  â”‚ + Lambda Web API                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Dependencies (pip):               â”‚   â”‚
â”‚  â”‚ â”œâ”€ boto3 (AWS SDK)               â”‚   â”‚
â”‚  â”‚ â”œâ”€ joblib (Model loading)        â”‚   â”‚
â”‚  â”‚ â”œâ”€ pandas (Data manipulation)    â”‚   â”‚
â”‚  â”‚ â”œâ”€ numpy (Numerical)             â”‚   â”‚
â”‚  â”‚ â”œâ”€ scikit-learn (Preprocessing)  â”‚   â”‚
â”‚  â”‚ â””â”€ xgboost (ML models)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Handler Code:                     â”‚   â”‚
â”‚  â”‚ lambda_predict_reintento.py       â”‚   â”‚
â”‚  â”‚ â”œâ”€ load_model_from_s3()          â”‚   â”‚
â”‚  â”‚ â”œâ”€ validate_event()              â”‚   â”‚
â”‚  â”‚ â”œâ”€ prepare_features_dataframe()  â”‚   â”‚
â”‚  â”‚ â”œâ”€ predict_retry_success()       â”‚   â”‚
â”‚  â”‚ â””â”€ lambda_handler()              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”’ Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SECURITY LAYERS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚ 1. S3 Security                                                       â”‚
â”‚    â”œâ”€ Block Public Access: âœ“ Enabled                                â”‚
â”‚    â”œâ”€ Encryption: âœ“ SSE-S3                                          â”‚
â”‚    â”œâ”€ Versioning: âœ“ Enabled                                         â”‚
â”‚    â””â”€ Access Control: âœ“ Lambda only                                 â”‚
â”‚                                                                      â”‚
â”‚ 2. Lambda Security                                                   â”‚
â”‚    â”œâ”€ IAM Role: âœ“ Least privilege                                   â”‚
â”‚    â”‚  â””â”€ Permissions: Only s3:GetObject on specific object         â”‚
â”‚    â”œâ”€ Timeout: âœ“ Limited (60 sec)                                   â”‚
â”‚    â”œâ”€ Memory: âœ“ Limited (512 MB)                                    â”‚
â”‚    â””â”€ Environment: âœ“ Encrypted variables                             â”‚
â”‚                                                                      â”‚
â”‚ 3. Network Security                                                  â”‚
â”‚    â”œâ”€ VPC: Optional (can be added)                                  â”‚
â”‚    â”œâ”€ Endpoints: Can use VPC endpoints for S3                       â”‚
â”‚    â””â”€ TLS: âœ“ All communications encrypted                           â”‚
â”‚                                                                      â”‚
â”‚ 4. Input Validation                                                 â”‚
â”‚    â”œâ”€ Field presence: âœ“ Validated                                   â”‚
â”‚    â”œâ”€ Data types: âœ“ Validated                                       â”‚
â”‚    â”œâ”€ Ranges: âœ“ Checked in preprocessing                            â”‚
â”‚    â””â”€ Injection protection: âœ“ No SQL/OS injection possible         â”‚
â”‚                                                                      â”‚
â”‚ 5. Logging & Monitoring                                             â”‚
â”‚    â”œâ”€ CloudWatch Logs: âœ“ All invocations logged                     â”‚
â”‚    â”œâ”€ Retention: âœ“ 30 days                                          â”‚
â”‚    â”œâ”€ Metrics: âœ“ Available                                          â”‚
â”‚    â””â”€ Alarms: Can be configured                                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Ciclo de Vida del Modelo

```
1. TRAINING (Offline)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ python3 ejecutar-evaluacion...    â”‚
   â”‚ (En tu mÃ¡quina local)             â”‚
   â”‚ â”œâ”€ Lee: suscripciones.xlsx       â”‚
   â”‚ â”œâ”€ Entrena: RandomForest, etc    â”‚
   â”‚ â””â”€ Genera: mejor_modelo.pkl      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ mejor_modelo.pkl
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ aws s3 cp mejor_modelo.pkl ...    â”‚
   â”‚ (Sube a S3 manualmente)           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚
                  â–¼
2. INFERENCE (Online)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Lambda carga modelo de S3         â”‚
   â”‚ (Una sola vez al startup)         â”‚
   â”‚ Guarda en memoria (_model)        â”‚
   â”‚                                   â”‚
   â”‚ Cada invocaciÃ³n:                  â”‚
   â”‚ â”œâ”€ Recibe evento JSON             â”‚
   â”‚ â”œâ”€ Preprocesa features            â”‚
   â”‚ â”œâ”€ Llama predict_proba()          â”‚
   â”‚ â””â”€ Retorna probabilidad + decisionâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Diagrama de Componentes de CDK

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MlRetriesStack                          â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ S3 Bucket (modelBucket)                            â”‚ â”‚
â”‚  â”‚ â€¢ BucketName: ml-retries-model-{ACC}-{REGION}     â”‚ â”‚
â”‚  â”‚ â€¢ Versioned: true                                  â”‚ â”‚
â”‚  â”‚ â€¢ Encrypted: SSE-S3                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Lambda (inferenceLambda)                           â”‚ â”‚
â”‚  â”‚ â€¢ DockerImageFunction                              â”‚ â”‚
â”‚  â”‚ â€¢ FromImageAsset: ./lambda/Dockerfile              â”‚ â”‚
â”‚  â”‚ â€¢ Linked to: modelBucket (ReadAccess)             â”‚ â”‚
â”‚  â”‚ â€¢ LogGroup: /aws/lambda/ml-retries-inference      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Step Functions (retriesStateMachine)               â”‚ â”‚
â”‚  â”‚ â€¢ Type: STANDARD                                   â”‚ â”‚
â”‚  â”‚ â€¢ Definition:                                      â”‚ â”‚
â”‚  â”‚   â”œâ”€ Pass: PrepareInput                            â”‚ â”‚
â”‚  â”‚   â”œâ”€ Map: ProcessRetriesMap                        â”‚ â”‚
â”‚  â”‚   â”‚  â”œâ”€ Task: InvokeInferenceLambda               â”‚ â”‚
â”‚  â”‚   â”‚  â”œâ”€ Choice: DecidirReintento                  â”‚ â”‚
â”‚  â”‚   â”‚  â”œâ”€ ReintentoAprobado (Pass)                   â”‚ â”‚
â”‚  â”‚   â”‚  â””â”€ ReintentoRechazado (Pass)                  â”‚ â”‚
â”‚  â”‚   â””â”€ Pass: FinalOutput                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Outputs                                            â”‚ â”‚
â”‚  â”‚ â€¢ ModelBucketName                                  â”‚ â”‚
â”‚  â”‚ â€¢ InferenceLambdaArn                               â”‚ â”‚
â”‚  â”‚ â€¢ StateMachineArn                                  â”‚ â”‚
â”‚  â”‚ â€¢ LambdaLogGroupName                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”Œ Interfaces de Datos

### Evento de Entrada (Lambda)

```json
{
  "monto": 150.0,              // NumÃ©rico: monto de transacciÃ³n
  "delta_horas": 5.0,          // NumÃ©rico: horas entre intento 1 y 2
  "retry_hour": 10,            // NumÃ©rico: hora del dÃ­a (0-23)
  "retry_dayofweek": 2,        // NumÃ©rico: dÃ­a semana (0-6)
  "retry_is_weekend": 0,       // NumÃ©rico: 0=weekday, 1=weekend
  "error_categoria": "cliente_4xx",    // String: categorÃ­a del error
  "detalle_fail": "Saldo insuficiente", // String: descripciÃ³n error
  "retry_hora_bucket": "manana"        // String: bucket horario
}
```

### Respuesta de Lambda

```json
{
  "statusCode": 200,
  "body": {
    "probabilidad_exito": 0.78,
    "reintentar": true,
    "threshold_usado": 0.3
  }
}
```

### Evento de State Machine

```json
{
  "retries": [
    { /* reintento 1 */ },
    { /* reintento 2 */ },
    { /* reintento 3 */ }
  ]
}
```

### Salida de State Machine

```json
{
  "results": [
    {
      "probabilidad_exito": 0.78,
      "reintentar": true,
      "threshold_usado": 0.3,
      "decision_result": {
        "decision": "APROBADO",
        "message": "Reintento recomendado"
      }
    },
    /* mÃ¡s resultados */
  ]
}
```

---

## âš¡ CaracterÃ­sticas de Performance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PERFORMANCE CHARACTERISTICS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Lambda Latency                                           â”‚
â”‚ â”œâ”€ Cold Start: ~2-5 segundos (primera invocaciÃ³n)      â”‚
â”‚ â”œâ”€ Warm Start: ~100-500ms (invocaciones siguientes)     â”‚
â”‚ â””â”€ Model Load: ~1-2 segundos (hecho una sola vez)      â”‚
â”‚                                                          â”‚
â”‚ Step Functions                                           â”‚
â”‚ â”œâ”€ Max Concurrency: 5 reintentos paralelos             â”‚
â”‚ â”œâ”€ State Transition: ~100ms                             â”‚
â”‚ â””â”€ Map Processing: Lineal en #de reintentos             â”‚
â”‚                                                          â”‚
â”‚ Model Inference                                          â”‚
â”‚ â”œâ”€ Prediction Time: ~5-10ms (after preprocessing)       â”‚
â”‚ â”œâ”€ Preprocessing Time: ~20-30ms                         â”‚
â”‚ â””â”€ Total P2P: ~100-300ms per request                    â”‚
â”‚                                                          â”‚
â”‚ Memory                                                   â”‚
â”‚ â”œâ”€ Lambda Allocated: 512 MB                             â”‚
â”‚ â”œâ”€ Model Size: ~50-200 MB (depending on model)         â”‚
â”‚ â””â”€ Available for Processing: ~300-400 MB                â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”— Flujo Completo Paso a Paso

```
1. Usuario EnvÃ­a Solicitud
   â””â”€ HTTP POST / AWS API
      â””â”€ { monto, delta_horas, ... }

2. Lambda Recibe Solicitud
   â”œâ”€ Verifica si modelo estÃ¡ cargado
   â”‚  â””â”€ Si no: carga de S3 (una sola vez)
   â””â”€ Procesa el evento

3. ValidaciÃ³n
   â”œâ”€ Verifica campos requeridos
   â”œâ”€ Verifica tipos de datos
   â””â”€ Si hay error: retorna statusCode 400

4. Preprocesamiento
   â”œâ”€ Convierte evento a DataFrame
   â”œâ”€ Aplica StandardScaler (numÃ©ricos)
   â”œâ”€ Aplica OneHotEncoder (categÃ³ricos)
   â””â”€ Asegura orden correcto de columnas

5. PredicciÃ³n
   â”œâ”€ Llama model.predict_proba()
   â”œâ”€ Obtiene probabilidad de clase 1
   â””â”€ Aplica threshold (0.3) para decisiÃ³n binaria

6. Respuesta
   â”œâ”€ statusCode: 200
   â””â”€ body: { probabilidad_exito, reintentar, threshold }

7. Logging
   â”œâ”€ Registra en CloudWatch Logs
   â”œâ”€ Incrementa mÃ©tricas CloudWatch
   â””â”€ Disponible para monitoring
```

---

## ðŸŽ¯ Casos de Uso

### Caso 1: PredicciÃ³n Individual en Tiempo Real
```
Usuario â†’ API Gateway â†’ Lambda â†’ PredicciÃ³n
                                â†“
                         Respuesta inmediata
```

### Caso 2: Procesamiento Batch de Reintentos
```
Sistema â†’ Step Functions â†’ Map (5 paralelos) â†’ Lambda (x5) â†’ Decisiones
                                                â†“
                                        Resultados consolidados
```

### Caso 3: Monitoring y Alertas
```
Lambda â†’ CloudWatch Logs â†’ Log Insights â†’ MÃ©tricas
                                        â†“
                                   Dashboards
                                      â†“
                                    Alertas
```

---

## ðŸš€ Escalabilidad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SCALABILITY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Lambda Concurrency                                       â”‚
â”‚ â€¢ Acceso de 1000 llamadas concurrentes                  â”‚
â”‚ â€¢ Escalado automÃ¡tico                                   â”‚
â”‚ â€¢ No requiere configuraciÃ³n                             â”‚
â”‚                                                          â”‚
â”‚ State Machine Concurrency                               â”‚
â”‚ â€¢ MÃ¡x 5 reintentos paralelos (configurable)             â”‚
â”‚ â€¢ Escalado automÃ¡tico                                   â”‚
â”‚ â€¢ Manejo de throttling integrado                        â”‚
â”‚                                                          â”‚
â”‚ S3 Performance                                           â”‚
â”‚ â€¢ Soporta >3,500 requests/sec                           â”‚
â”‚ â€¢ No hay bottleneck en modelo                           â”‚
â”‚                                                          â”‚
â”‚ Costos                                                   â”‚
â”‚ â€¢ Bajo costo por invocaciÃ³n (~$0.000002)               â”‚
â”‚ â€¢ Gratis primeros 1M invocaciones/mes                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Documento: `ARCHITECTURE.md` | Ãšltima actualizaciÃ³n: Noviembre 2025
